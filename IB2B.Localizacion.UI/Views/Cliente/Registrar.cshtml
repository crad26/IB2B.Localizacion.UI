@model IB2B.Localizacion.UI.Models.ClienteModels

@{
    ViewBag.Title = "Registrar";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@*<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/gijgo@1.8.1/combined/js/gijgo.min.js" type="text/javascript"></script>
<link href="https://cdn.jsdelivr.net/npm/gijgo@1.8.1/combined/css/gijgo.min.css" rel="stylesheet" type="text/css" />*@

@using (Ajax.BeginForm("Registrar", "Cliente", new AjaxOptions { HttpMethod = "POST", OnSuccess = "RegistroResult" }, new { id = "formCliente", @class = "form-horizontal" }))
{
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    <div class="panel panel-default m-t-sm box box-primary" style="top:200px">
        <div class="panel-heading p-t-xxs p-b-none">
            <div class="row">
                <div class="col-sm-12">
                    <label>
                        <i class="glyphicon glyphicon-user"></i>&nbsp;&nbsp; Registro de Cliente
                    </label>
                </div>
            </div>
        </div>
        <div class="panel-body p-t-xxs">
            
            <div class="col-sm-12">
                <div class="row">
                    <div class="col-sm-5">
                        <div class="row">
                            <div class='input-group'>
                                <span class="input-group-addon">
                                    ID Cliente
                                </span>
                                @Html.TextBoxFor(model => model.oClienteBE.CUSTNMBR, new { @class = "form-control", onchange = "BuscarClienteRUC()" })
                            </div><br />
                            @Html.ValidationMessageFor(model => model.oClienteBE.CUSTNMBR, "", new { @class = "text-danger" })
                        </div>
                        
                    </div>
                    <div class="col-sm-2"></div><br />
                    <div class="col-sm-5">
                        <div class="row">
                            <div class='input-group'>
                                <span class="input-group-addon">
                                    Descripcion
                                </span>
                                @Html.TextBoxFor(model => model.oClienteBE.CUSTNAME, new { @class = "form-control" })
                            </div><br />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-5">
                        <div class="row">
                            <div class='input-group'>
                                <span class="input-group-addon">
                                    Tipo de Persona
                                </span>
                                @Html.DropDownListFor(model => model.oClienteBE.oTipoPersonaBE.TipoPersonaID, new SelectList(Model.vLTipoPersonaBE, "TipoPersonaID", "TipoPersonaNombre"), "- Seleccione -", new { @class = "form-control" })
                                
                            </div>
                            @Html.ValidationMessageFor(model => model.oClienteBE.oTipoPersonaBE.TipoPersonaID, "", new { @class = "text-danger" })
                        </div>
                        
                    </div>
                    <div class="col-sm-2"></div><br />
                    <div class="col-sm-5">
                        <div class="row">
                            <div class='input-group'>
                                <span class="input-group-addon">
                                    Razón Social
                                </span>
                                @Html.TextBoxFor(model => model.oClienteBE.TB_RAZON_SOCIAL, new { @class = "form-control" })
                            </div><br />
                        </div>
                    </div>        

                </div>
            <!---->
                <div class="row">
                    <div class="col-sm-5">
                        <div class="row">
                            <div class='input-group'>
                                <span class="input-group-addon">
                                    Número de Documento
                                </span>
                                @Html.TextBoxFor(model => model.oClienteBE.TB_NRO_DOCUMENTO, new { @class = "form-control" })
                            </div><br />
                        </div>
                    </div>
                    <div class="col-sm-2"></div><br />
                    <div class="col-sm-5">
                        <div class="row">
                            <div class='input-group'>
                                <span class="input-group-addon">
                                    Tipo de documento
                                </span>
                                @Html.DropDownListFor(model => model.oClienteBE.oTipoDocumentoBE.TipoDocumentoID, new SelectList(Model.vLTipoDocumentoBE, "TipoDocumentoID", "TipoDocumentoNombre"), "- Seleccione -", new { @class = "form-control" })


                            </div><br />
                            @Html.ValidationMessageFor(model => model.oClienteBE.oTipoDocumentoBE, "", new { @class = "text-danger" })
                        </div>

                    </div>  
                </div>

                <!---->
                <div class="row">
                    <div class="col-sm-5">
                        <div class="row">
                            <div class='input-group'>
                                <span class="input-group-addon">
                                    Número Referencia
                                </span>
                                @Html.TextBoxFor(model => model.oClienteBE.TB_REFERENCIA, new { @class = "form-control number" })
                            </div><br/><br />
                        </div>
                    </div>
                    <div class="col-sm-2"></div><br />
                    <div class="col-sm-5">
                        <div class="row">
                            <br/>
                        </div>
                    </div>
                </div>
                <!---->


                <!---->
                <div class="row">
                    <div class="col-sm-5">
                        <div class="row">
                            <div class='input-group'>
                                <span class="input-group-addon">
                                    Apellido Paterno
                                </span>
                                @Html.TextBoxFor(model => model.oClienteBE.FRSTNAME, new { @class = "form-control" })
                            </div><br />
                        </div>
                        <div class="row">
                            <div class='input-group'>
                                <span class="input-group-addon">
                                    Apellido Materno
                                </span>
                                @Html.TextBoxFor(model => model.oClienteBE.SHRTNAME, new { @class = "form-control" })
                                                          
                            </div><br />
                        </div>
                        <div class="row">
                            <div class='input-group'>
                                <span class="input-group-addon">
                                    Primer Nombre
                                </span>
                                @Html.TextBoxFor(model => model.oClienteBE.LASTNAME, new { @class = "form-control" })
                            </div><br />
                        </div>
                        <div class="row">
                            <div class='input-group'>
                                <span class="input-group-addon">
                                    Segundo Nombre
                                </span>
                                @Html.TextBoxFor(model => model.oClienteBE.MIDLNAME, new { @class = "form-control" })
                            </div><br />
                        </div>
                    </div>
                    <div class="col-sm-2"></div><br />


                    <div class="col-sm-5">
                        <div class="row">
                            <div class="col-sm-5" >
                                <div class="row">
                                    @Html.CheckBoxFor(model => Model.oClienteBE.CB_BC, new {id = "BC" })
                                    <label class="form-check-label" for="BC">
                                        Buen Contribuyente
                                    </label>
 
                                </div>
                            </div>
                            <div class="col-sm-2"></div>
                            <div class="col-sm-5" style="margin-top:8px">
                                <div class="row">
                                    <div class='input-group'>
                                        @Html.TextBoxFor(model => model.oClienteBE.DT_BC_FECHA1, new { @class = "form-control ", id= "datepicker" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-5">
                                <div class="row">
                                    @Html.CheckBoxFor(model => Model.oClienteBE.CB_AR, new { id = "AR" })
                                    <label class="form-check-label" for="AR">
                                        Agente Retenedor
                                    </label>

                                </div>
                            </div>
                            <div class="col-sm-2"></div>
                            <div class="col-sm-5" style="margin-top:8px">
                                <div class="row">
                                    <div class='input-group'>

                                        @Html.TextBoxFor(model => model.oClienteBE.DT_AR_FECHA1, new { @class = "form-control" })
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-5">
                                <div class="row">
                                    @Html.CheckBoxFor(model => Model.oClienteBE.CB_AP, new { id = "AP" })
                                    <label class="form-check-label" for="AP">
                                        Agente Perceptor
                                    </label>

                                </div>
                            </div>
                            <div class="col-sm-2"></div>
                            <div class="col-sm-5" style="margin-top:8px">
                                <div class="row">
                                    <div class='input-group'>

                                        @Html.TextBoxFor(model => model.oClienteBE.DT_AP_FECHA1, new { @class = "form-control" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-5">
                                <div class="row">
                                    @Html.CheckBoxFor(model => Model.oClienteBE.CB_NH, new { id = "NH" })
                                    <label class="form-check-label" for="NH">
                                        No Habido
                                    </label>

                                </div>
                            </div>
                            <div class="col-sm-2"></div>
                            <div class="col-sm-5" style="margin-top:8px">
                                <div class="row">
                                    <div class='input-group'>

                                        @Html.TextBoxFor(model => model.oClienteBE.DT_NH_FECHA1, new { @class = "form-control" })
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-5">
                                <div class="row">
                                    @Html.CheckBoxFor(model => Model.oClienteBE.CB_RI, new { id = "NE" })
                                    <label class="form-check-label" for="NE">
                                        No Exoneracion
                                    </label>

                                </div>
                            </div>
                            <div class="col-sm-2"></div>
                            <div class="col-sm-5" style="margin-top:8px">
                                <div class="row">
                                    <div class='input-group'>

                                        @Html.TextBoxFor(model => model.oClienteBE.DT_RI_FECHA1, new { @class = "form-control"})
                                    </div>
                                </div>
                            </div>
                        </div>

           
                        </div>
                </div>
                <!---->
            </div>
        </div>
    </div>
}

<script type="text/javascript">
    var v_TituloMensaje = 'Registro Cliente';
    $(document).ready(function () {
        document.getElementById("btnNuevoRegistro").style.display = "none";
        document.getElementById("btnEditarRegistro").style.display = "none";
        var v_ClienteModelsBE = @(Html.Raw(Json.Encode(@Model)));
        $('#@Html.IdFor(m => m.oClienteBE.CUSTNMBR)');
        $('#@Html.IdFor(m => m.oClienteBE.TB_NRO_DOCUMENTO)').prop('disabled',false);
        $('#@Html.IdFor(m => m.oClienteBE.TB_RAZON_SOCIAL)').prop('disabled',true);
        $('#@Html.IdFor(m => m.oClienteBE.CUSTNMBR)').focus();
        if(!v_ClienteModelsBE.oClienteBE.CB_BC) {
            $('#@Html.IdFor(m => m.oClienteBE.DT_BC_FECHA1)').prop('disabled',false);
        }
        if(!v_ClienteModelsBE.oClienteBE.CB_AR) {
            $('#@Html.IdFor(m => m.oClienteBE.DT_AR_FECHA1)').prop('disabled',false);
        }
        if(!v_ClienteModelsBE.oClienteBE.CB_AP) {
            $('#@Html.IdFor(m => m.oClienteBE.DT_AP_FECHA1)').prop('disabled',false);
        }
        if(!v_ClienteModelsBE.oClienteBE.CB_NH) {
            $('#@Html.IdFor(m => m.oClienteBE.DT_NH_FECHA1)').prop('disabled',false);
        }
        if(!v_ClienteModelsBE.oClienteBE.CB_RI) {
            $('#@Html.IdFor(m => m.oClienteBE.DT_RI_FECHA1)').prop('disabled',false);
        }
    });

    function RegistroResult(pData) {
        if (pData.Resultado == '@IB2B.Localizacion.BE.BE.Constantes.ResultadoSistema.Ok') {
            location.href = '@Url.Action("Listar", "Cliente")';
        }
        else {
            fc_MensajeBootBox('warning', v_TituloMensaje, pData.Mensaje);
        }
    }

    function ActivarFecha(pTipo) {
        if(pTipo == 1) { //Buen Contribuyente
            $('#@Html.IdFor(m => m.oClienteBE.DT_BC_FECHA1)').prop('disabled',!$('#@Html.IdFor(m => m.oClienteBE.CB_BC)').is(':checked'));
            if(!$('#@Html.IdFor(m => m.oClienteBE.CB_BC)').is(':checked')) {
                $('#@Html.IdFor(m => m.oClienteBE.DT_BC_FECHA1)').val('');
            }
        }
        else if(pTipo == 2) { //Agente Retenedor
            $('#@Html.IdFor(m => m.oClienteBE.DT_AR_FECHA1)').prop('disabled',!$('#@Html.IdFor(m => m.oClienteBE.CB_AR)').is(':checked'));
            if(!$('#@Html.IdFor(m => m.oClienteBE.CB_AR)').is(':checked')) {
                $('#@Html.IdFor(m => m.oClienteBE.DT_AR_FECHA1)').val('');
            }
        }
        else if(pTipo == 3) { //Agente Perceptor
            $('#@Html.IdFor(m => m.oClienteBE.DT_AP_FECHA1)').prop('disabled',!$('#@Html.IdFor(m => m.oClienteBE.CB_AP)').is(':checked'));
            if(!$('#@Html.IdFor(m => m.oClienteBE.CB_AP)').is(':checked')) {
                $('#@Html.IdFor(m => m.oClienteBE.DT_AP_FECHA1)').val('');
            }
        }
        else if(pTipo == 4) { //No habido
            $('#@Html.IdFor(m => m.oClienteBE.DT_NH_FECHA1)').prop('disabled',!$('#@Html.IdFor(m => m.oClienteBE.CB_NH)').is(':checked'));
            if(!$('#@Html.IdFor(m => m.oClienteBE.CB_NH)').is(':checked')) {
                $('#@Html.IdFor(m => m.oClienteBE.DT_NH_FECHA1)').val('');
            }
        }
        else if(pTipo == 5) { //No Exoneracion
            $('#@Html.IdFor(m => m.oClienteBE.DT_RI_FECHA1)').prop('disabled',!$('#@Html.IdFor(m => m.oClienteBE.CB_RI)').is(':checked'));
            if(!$('#@Html.IdFor(m => m.oClienteBE.CB_RI)').is(':checked')) {
                $('#@Html.IdFor(m => m.oClienteBE.DT_RI_FECHA1)').val('');
            }
        }
    }

    function GuardarRegistro() {

        var form = $('#formCliente');
        if (form.valid()) {
            var fc_Registrar = function () {

                $("#formCliente").submit();
            }
            fc_MensajeBootBoxConfirm('info', v_TituloMensaje, "¿Desea guardar la información del Cliente?", fc_Registrar, function () { });
        }
    }

    $(".number").keydown(function (e) {

        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
            (e.keyCode == 65 && e.ctrlKey === true) ||
            (e.keyCode >= 35 && e.keyCode <= 39)) {



            return;
        }
        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {

            e.preventDefault();
        }
    });


    $('#datepicker').datepicker({
        uiLibrary: 'bootstrap'
    });

    function BuscarClienteRUC() {
        $.ajax({
            type: 'POST',
            url: '@Url.Action("ConsultaSUNAT", "Cliente")',
            data: { pDocumentoId: $('#@Html.IdFor(m => m.oClienteBE.CUSTNMBR)').val() },
            success: function (pData) {
                if(pData.Resultado == '@IB2B.Localizacion.BE.BE.Constantes.ResultadoSistema.Error') {
                    fc_MensajeBootBox('warning', v_TituloMensaje, pData.Mensaje);
                }
                else {
                    $('#@Html.IdFor(m => m.oClienteBE.oTipoPersonaBE.TipoPersonaID)').val(pData.oTipoPersonaBE.TipoPersonaID);
                    $('#@Html.IdFor(m => m.oClienteBE.oTipoDocumentoBE.TipoDocumentoID)').val(pData.oTipoDocumentoBE.TipoDocumentoID);
                    $('#BC').prop('checked',true)

                    $('#@Html.IdFor(m => m.oClienteBE.TB_NRO_DOCUMENTO)').val(pData.TB_NRO_DOCUMENTO);
                    $('#@Html.IdFor(m => m.oClienteBE.TB_RAZON_SOCIAL)').val(pData.TB_RAZON_SOCIAL);
                    $('#@Html.IdFor(m => m.oClienteBE.CUSTNAME)').val(pData.CUSTNAME);
                    $('#@Html.IdFor(m => m.oClienteBE.FRSTNAME)').val(pData.FRSTNAME);
                    $('#@Html.IdFor(m => m.oClienteBE.SHRTNAME)').val(pData.SHRTNAME);
                    $('#@Html.IdFor(m => m.oClienteBE.LASTNAME)').val(pData.LASTNAME);
                    $('#@Html.IdFor(m => m.oClienteBE.MIDLNAME)').val(pData.MIDLNAME);

                }
            },
            Error: function () {
                alert('Error no controlado.');
            }
        });
    }
</script>